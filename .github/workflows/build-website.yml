name: Build website CI

on:
  push:
    branches: 
      - main
      - feature/tests

permissions: 
  contents: write

jobs:
  build:
    concurrency: ci-${{ github.ref }}
    runs-on: ubuntu-latest
    steps:
      - name: Prepare dirs
        run: |
          mkdir source
          mkdir build
      - name: Checkout source ğŸ›ï¸
        uses: actions/checkout@v3
        with:
          path: ./source
      - name: Checkout gh-pages ğŸ›ï¸
        uses: actions/checkout@v3
        with:
          path: ./build
          ref: gh-pages
      - name: Setup
        uses: pnpm/action-setup@v2.2.2
        with:
          version: 7.1.3
      - name: Install
        working-directory: ./source/src
        run: pnpm i
      - name: Build
        working-directory: ./source/src
        run: pnpm ci
      - name: Copy to build
        working-directory: ./source/src
        run: cp -r dist ../../build
      - name: Deploy ğŸš€
        working-directory: ./build
        run: |
          git add *
          git commit -m "feat(gp): deploy website"
          git push
      - name: Cleanup
        run: |
          rm -rf build
          rm -rf source
